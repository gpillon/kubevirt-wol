---
apiVersion: security.openshift.io/v1
kind: SecurityContextConstraints
metadata:
  name: kubevirt-wol-scc
  annotations:
    kubernetes.io/description: "SCC for KubeVirt WOL Operator. Allows hostNetwork to receive broadcast UDP packets."
# Allow host network for receiving broadcast UDP packets
allowHostNetwork: true
allowHostPorts: true
# Port range for WOL (default 9, but allow some flexibility)
allowHostDirVolumePlugin: false
allowHostIPC: false
allowHostPID: false
allowPrivilegeEscalation: true
allowPrivilegedContainer: true
# Allow any UID including root for privileged port binding
runAsUser:
  type: RunAsAny
# SELinux - use RunAsAny for more flexibility with capabilities
seLinuxContext:
  type: RunAsAny
# Supplemental groups
supplementalGroups:
  type: RunAsAny
# FSGroup
fsGroup:
  type: RunAsAny
# Volumes
volumes:
  - configMap
  - downwardAPI
  - emptyDir
  - persistentVolumeClaim
  - projected
  - secret
# Capabilities
# NET_BIND_SERVICE is required to bind to UDP port 9 (privileged port < 1024)
allowedCapabilities:
  - NET_BIND_SERVICE
defaultAddCapabilities: []
requiredDropCapabilities:
  - ALL
# Priority
priority: 10
# Read-only root filesystem
readOnlyRootFilesystem: false
# Users and groups that can use this SCC
users: []
groups: []
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kubevirt-wol-scc-user
rules:
  - apiGroups:
      - security.openshift.io
    resources:
      - securitycontextconstraints
    resourceNames:
      - kubevirt-wol-scc
    verbs:
      - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kubevirt-wol-scc-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kubevirt-wol-scc-user
subjects:
  - kind: ServiceAccount
    name: kubevirt-wol-controller-manager
    namespace: kubevirt-wol-system

